<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#2563eb">
  <meta name="description" content="SmartScan - Dokumente digitalisieren mit KI-Kategorisierung und Dropbox-Speicherung">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="SmartScan">

  <title>SmartScan</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/favicon.ico">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="styles/main.css">

  <!-- jsPDF for PDF conversion -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>
<body>
  <div class="app" id="app">
    <!-- Header -->
    <header class="header">
      <a href="#" class="header__logo" id="logo">
        <svg class="header__logo-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="4" y="4" width="24" height="24" rx="4" fill="currentColor" fill-opacity="0.1"/>
          <path d="M10 12h12M10 16h12M10 20h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <circle cx="24" cy="24" r="6" fill="currentColor"/>
          <path d="M22 24l2 2 3-3" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>SmartScan</span>
      </a>
      <div class="header__actions">
        <button type="button" class="btn btn--icon btn--ghost" id="settings-btn" aria-label="Einstellungen">
          <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m7.07 7.07l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m7.07-7.07l4.24-4.24"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Main Content / Screens -->
    <main class="screens">
      <!-- Home Screen -->
      <section class="screen home active" id="screen-home" aria-label="Startseite">
        <div class="home__hero">
          <h1 class="home__title">Dokumente digitalisieren</h1>
          <p class="home__subtitle">Fotografieren, kategorisieren und automatisch in Dropbox speichern.</p>

          <div class="home__features">
            <div class="home__feature">
              <svg class="home__feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                <circle cx="12" cy="13" r="4"/>
              </svg>
              <span class="home__feature-text">Dokument mit der Kamera aufnehmen oder aus Galerie wählen</span>
            </div>
            <div class="home__feature">
              <svg class="home__feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2a10 10 0 1 0 10 10H12V2z"/>
                <path d="M12 2a10 10 0 0 1 10 10"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <span class="home__feature-text">KI erkennt automatisch Dokumenttyp, Datum und Namen</span>
            </div>
            <div class="home__feature">
              <svg class="home__feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              <span class="home__feature-text">Als PDF in Dropbox speichern - automatisch sortiert</span>
            </div>
          </div>
        </div>

        <div class="home__actions">
          <button type="button" class="btn btn--primary btn--large" id="btn-start-scan">
            <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
              <circle cx="12" cy="13" r="4"/>
            </svg>
            Dokument scannen
          </button>
        </div>

        <p class="text-muted text-center" id="auth-status" style="margin-top: auto; padding-top: var(--spacing-lg);">
          Nicht mit Dropbox verbunden
        </p>
      </section>

      <!-- Camera Screen -->
      <section class="screen camera" id="screen-camera" aria-label="Kamera">
        <div class="camera__viewfinder">
          <video class="camera__video" id="camera-video" autoplay playsinline></video>
          <canvas class="camera__canvas" id="camera-canvas"></canvas>
          <div class="camera__overlay">
            <div class="camera__guide"></div>
          </div>
        </div>
        <div class="camera__controls">
          <label class="camera__upload-label" aria-label="Bild hochladen">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            <input type="file" class="camera__upload-input" id="file-upload" accept="image/*">
          </label>
          <button type="button" class="camera__capture-btn" id="btn-capture" aria-label="Foto aufnehmen"></button>
          <button type="button" class="btn btn--icon btn--ghost camera__switch-btn" id="btn-switch-camera" aria-label="Kamera wechseln">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 3h5v5"/>
              <path d="M8 21H3v-5"/>
              <path d="M21 3l-7 7"/>
              <path d="M3 21l7-7"/>
            </svg>
          </button>
        </div>
        <button type="button" class="btn btn--secondary" id="btn-camera-back" style="position: absolute; top: var(--spacing-lg); left: var(--spacing-lg);">
          <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"/>
            <polyline points="12 19 5 12 12 5"/>
          </svg>
          Zurück
        </button>
      </section>

      <!-- Processing Screen -->
      <section class="screen processing" id="screen-processing" aria-label="Verarbeitung">
        <div class="processing__preview">
          <img class="processing__preview-img" id="processing-preview" src="" alt="Dokument Vorschau">
        </div>
        <div class="processing__spinner" role="status" aria-label="Wird verarbeitet"></div>
        <p class="processing__status" id="processing-status">Dokument wird analysiert...</p>
        <p class="processing__substatus" id="processing-substatus">KI erkennt Dokumentdetails</p>
      </section>

      <!-- Edit Screen -->
      <section class="screen edit" id="screen-edit" aria-label="Bearbeiten">
        <div class="edit__preview">
          <img class="edit__preview-img" id="edit-preview" src="" alt="Dokument Vorschau">
        </div>

        <form class="edit__form" id="edit-form">
          <div class="form-group">
            <label class="form-label" for="edit-category">Kategorie</label>
            <select class="form-select" id="edit-category" required>
              <option value="">Bitte wählen...</option>
              <option value="invoice">Rechnung</option>
              <option value="receipt">Beleg</option>
              <option value="contract">Vertrag</option>
              <option value="letter">Brief</option>
              <option value="tax">Steuer</option>
              <option value="insurance">Versicherung</option>
              <option value="medical">Medizinisch</option>
              <option value="bank">Bank</option>
              <option value="warranty">Garantie</option>
              <option value="other">Sonstiges</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="edit-date">Datum</label>
            <input type="date" class="form-input" id="edit-date" required>
          </div>

          <div class="form-group">
            <label class="form-label" for="edit-name">Dokumentname</label>
            <input type="text" class="form-input" id="edit-name" placeholder="z.B. Stromrechnung Januar" required>
            <p class="form-hint">Der Dateiname wird automatisch generiert</p>
          </div>

          <div class="form-group">
            <label class="form-label" for="edit-notes">Notizen (optional)</label>
            <textarea class="form-textarea" id="edit-notes" placeholder="Zusätzliche Informationen..."></textarea>
          </div>

          <div class="edit__actions">
            <button type="button" class="btn btn--secondary" id="btn-edit-back">
              <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"/>
                <polyline points="12 19 5 12 12 5"/>
              </svg>
              Zurück
            </button>
            <button type="submit" class="btn btn--primary" id="btn-save">
              <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              Speichern
            </button>
          </div>
        </form>
      </section>

      <!-- Success Screen -->
      <section class="screen success" id="screen-success" aria-label="Erfolg">
        <svg class="success__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>

        <h2 class="success__title">Erfolgreich gespeichert!</h2>
        <p class="success__message">Ihr Dokument wurde als PDF in Dropbox gespeichert.</p>

        <div class="success__details">
          <div class="success__detail">
            <span class="success__detail-label">Dateiname</span>
            <span class="success__detail-value" id="success-filename">-</span>
          </div>
          <div class="success__detail">
            <span class="success__detail-label">Ordner</span>
            <span class="success__detail-value" id="success-folder">-</span>
          </div>
          <div class="success__detail">
            <span class="success__detail-label">Kategorie</span>
            <span class="success__detail-value" id="success-category">-</span>
          </div>
        </div>

        <div class="home__actions" style="margin-top: var(--spacing-lg);">
          <button type="button" class="btn btn--primary btn--large" id="btn-scan-another">
            <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
              <circle cx="12" cy="13" r="4"/>
            </svg>
            Weiteres Dokument
          </button>
          <button type="button" class="btn btn--secondary btn--large" id="btn-go-home">
            <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
              <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
            Startseite
          </button>
        </div>
      </section>
    </main>

    <!-- Settings Panel -->
    <div class="settings-panel__overlay" id="settings-overlay"></div>
    <aside class="settings-panel" id="settings-panel" aria-label="Einstellungen">
      <div class="settings-panel__header">
        <h2 class="settings-panel__title">Einstellungen</h2>
        <button type="button" class="btn btn--icon btn--ghost" id="settings-close" aria-label="Schließen">
          <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <div class="settings-panel__content">
        <div class="settings-section">
          <h3 class="settings-section__title">Dropbox</h3>
          <div class="form-group">
            <label class="form-label" for="settings-dropbox-client-id">Client ID</label>
            <input type="text" class="form-input" id="settings-dropbox-client-id" placeholder="Dropbox App Client ID">
            <p class="form-hint">Erstelle eine App unter <a href="https://www.dropbox.com/developers/apps" target="_blank" rel="noopener">Dropbox Developers</a></p>
          </div>
          <button type="button" class="btn btn--primary" id="btn-dropbox-connect">
            Mit Dropbox verbinden
          </button>
          <button type="button" class="btn btn--secondary hidden" id="btn-dropbox-disconnect">
            Verbindung trennen
          </button>
        </div>

        <div class="settings-section">
          <h3 class="settings-section__title">Claude API</h3>
          <div class="form-group">
            <label class="form-label" for="settings-claude-key">API Key</label>
            <input type="password" class="form-input" id="settings-claude-key" placeholder="sk-ant-...">
            <p class="form-hint">API Key von <a href="https://console.anthropic.com/" target="_blank" rel="noopener">Anthropic Console</a></p>
          </div>
          <button type="button" class="btn btn--primary" id="btn-claude-save">
            Speichern
          </button>
        </div>

        <div class="settings-section">
          <h3 class="settings-section__title">Speicher</h3>
          <button type="button" class="btn btn--danger" id="btn-clear-data">
            Alle Daten löschen
          </button>
          <p class="form-hint">Löscht API-Keys, Token und Einstellungen</p>
        </div>

        <div class="settings-section" style="margin-top: auto; padding-top: var(--spacing-lg); border-top: 1px solid var(--border-color);">
          <p class="text-muted" style="font-size: 0.75rem;">
            SmartScan v1.0.0<br>
            Made with Claude AI
          </p>
        </div>
      </div>
    </aside>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container" aria-live="polite"></div>
  </div>

  <!-- App Scripts -->
  <script type="module" src="src/app.js"></script>
</body>
</html>
